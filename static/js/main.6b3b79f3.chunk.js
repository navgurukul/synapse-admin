(this["webpackJsonpnavgurukul-admin"]=this["webpackJsonpnavgurukul-admin"]||[]).push([[0],{367:function(e,a,t){e.exports=t(513)},513:function(e,a,t){"use strict";t.r(a);var r=t(0),n=t.n(r),s=t(15),o=t.n(s),i=t(281),c=t(604),l=t(603),u=t(179),m=t(132),d={login:function(e){var a=e.base_url,t=e.username,r=e.password;console.log("login ");var n={method:"POST",body:JSON.stringify({type:"m.login.password",user:t,password:r})};localStorage.setItem("base_url",a);var s=window.decodeURIComponent(a)+"/_matrix/client/r0/login";return m.a.fetchJson(s,n).then((function(e){var a=e.json;localStorage.setItem("home_server",a.home_server),localStorage.setItem("user_id",a.user_id),localStorage.setItem("access_token",a.access_token),localStorage.setItem("device_id",a.device_id)}))},logout:function(){return console.log("logout "),localStorage.removeItem("access_token"),Promise.resolve()},checkError:function(e){var a=e.status;return console.log("checkError "+a),401===a||403===a?Promise.reject():Promise.resolve()},checkAuth:function(){var e=localStorage.getItem("access_token");return console.log("checkAuth "+e),"string"==typeof e?Promise.resolve():Promise.reject()},getPermissions:function(){return Promise.resolve()}},g=t(155),p=t(22),f=t(70),b=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=localStorage.getItem("access_token");return console.log("httpClient "+e),null!=t&&(a.user={authenticated:!0,token:"Bearer ".concat(t)}),m.a.fetchJson(e,a)},h=function(e,a){return e.indexOf("navgurukul.org")>-1?e:"users"===a?"@"+e+":navgurukul.org":"rooms"===a?"#"+e+":navgurukul.org":e},v={users:{path:"/_synapse/admin/v2/users",map:function(e){return Object(p.a)(Object(p.a)({},e),{},{id:e.name.split(":")[0].slice(1),is_guest:!!e.is_guest,admin:!!e.admin,deactivated:!!e.deactivated})},data:"users",total:function(e,a,t){return e.next_token?parseInt(e.next_token,10)+t:a+e.users.length},create:function(e){return{endpoint:"/_synapse/admin/v2/users/".concat(e.id),body:e,method:"PUT"}},delete:function(e){return{endpoint:"/_synapse/admin/v1/deactivate/".concat(h(e,"users")),body:{erase:!0,id:e},method:"POST"}}},rooms:{path:"/_synapse/admin/v1/rooms",map:function(e){return Object(p.a)(Object(p.a)({},e),{},{id:e.room_id,alias:e.canonical_alias,members:e.joined_members})},data:"rooms",total:function(e){return e.total_rooms}},connections:{path:"/_synapse/admin/v1/whois",map:function(e){return Object(p.a)(Object(p.a)({},e),{},{id:h(e.user_id)})},data:"connections"}};function _(e,a){if(null!==a)return a}var E={getList:function(e,a){console.log("getList "+e);var t=a.filter,r=t.user_id,n=t.guests,s=t.deactivated,o=a.pagination,i=o.page,c=o.perPage,l=(i-1)*c,u={from:l,limit:c,user_id:r,guests:n,deactivated:s},m=localStorage.getItem("base_url");if(!m||!(e in v))return Promise.reject();var d=v[e],g=m+d.path,p="".concat(g,"?").concat(Object(f.stringify)(u));return b(p).then((function(e){var a=e.json;return{data:a[d.data].map(d.map),total:d.total(a,l,c)}}))},getOne:function(e,a){console.log("getOne "+e);var t=localStorage.getItem("base_url");if(!t||!(e in v))return Promise.reject();var r=v[e];a.id=h(a.id,e);var n=t+r.path;return b("".concat(n,"/").concat(a.id)).then((function(e){var a=e.json;return{data:r.map(a)}}))},getMany:function(e,a){console.log("getMany "+e);var t=localStorage.getItem("base_url");if(!t||!(e in v))return Promise.reject();var r=v[e],n=t+r.path;return Promise.all(a.ids.map((function(a){return console.log(a),b("".concat(n,"/").concat(h(a,e)))}))).then((function(e){return{data:e.map((function(e){var a=e.json;return r.map(a)}))}}))},getManyReference:function(e,a){console.log("getManyReference "+e);var t=a.pagination,r=t.page,n=t.perPage,s=a.sort,o=s.field,i=s.order,c={sort:JSON.stringify([o,i]),range:JSON.stringify([(r-1)*n,r*n-1]),filter:JSON.stringify(Object(p.a)(Object(p.a)({},a.filter),{},Object(g.a)({},a.target,a.id)))},l=localStorage.getItem("base_url");if(!l||!(e in v))return Promise.reject();var u=l+v[e].path,m="".concat(u,"?").concat(Object(f.stringify)(c));return b(m).then((function(e){var a=e.headers;return{data:e.json,total:parseInt(a.get("content-range").split("/").pop(),10)}}))},update:function(e,a){console.log("update "+e);var t=localStorage.getItem("base_url");if(!t||!(e in v))return Promise.reject();var r=v[e],n=t+r.path;return b("".concat(n,"/").concat(h(a.data.id,e)),{method:"PUT",body:JSON.stringify(a.data,_)}).then((function(e){var a=e.json;return{data:r.map(a)}}))},updateMany:function(e,a){console.log("updateMany "+e);var t=localStorage.getItem("base_url");if(!t||!(e in v))return Promise.reject();var r=t+v[e].path;return Promise.all(a.ids.map((function(a){return b("".concat(r,"/").concat(h(a,e)))}),{method:"PUT",body:JSON.stringify(a.data,_)})).then((function(e){return{data:e.map((function(e){return e.json}))}}))},create:function(e,a){console.log("create "+e);var t=localStorage.getItem("base_url");if(!t||!(e in v))return Promise.reject();var r=v[e];if(!("create"in r))return Promise.reject();a.data.id=h(a.data.id,e),a.data.threepids=[],a.data.email&&a.data.threepids.push({medium:"email",address:a.data.email}),a.data.msisdn&&a.data.threepids.push({medium:"msisdn",address:a.data.msisdn});var n=r.create(a.data),s=t+n.endpoint;return b(s,{method:n.method,body:JSON.stringify(n.body,_)}).then((function(e){var a=e.json;return{data:r.map(a)}}))},delete:function(e,a){console.log("delete "+e);var t=localStorage.getItem("base_url");if(!t||!(e in v))return Promise.reject();var r=v[e];if("delete"in r){var n=r.delete(a.id),s=t+n.endpoint;return console.log(23,n.body),b(s,{method:n.method,body:JSON.stringify(n.body)}).then((function(e){return{data:e.json}}))}console.log(12,a);var o=t+r.path;return b("".concat(o,"/").concat(a.id),{method:"DELETE",body:JSON.stringify(a.data,_)}).then((function(e){return{data:e.json}}))},deleteMany:function(e,a){console.log("deleteMany "+e,a);var t=localStorage.getItem("base_url");if(!t||!(e in v))return Promise.reject();var r=v[e];if("delete"in r)return Promise.all(a.ids.map((function(e){var a=r.delete(e),n=t+a.endpoint;return console.log(n),b(n,{method:a.method,body:JSON.stringify(a.body)})}))).then((function(e){return{data:e.map((function(e){return e.json}))}}));var n=t+r.path;return console.log(n),Promise.all(a.ids.map((function(t){return console.log(t),b("".concat(n,"/").concat(h(t,e)),{method:"DELETE",body:JSON.stringify(a.data,_)})}))).then((function(e){return{data:e.map((function(e){return e.json}))}}))}},y=t(313),j=t.n(y),O=t(316),k=t.n(O),w=t(330),P=t(612),S=t(613),I=t(40),A=t(332),N=t(606),z=t(605),D=t(609),M=t(591),R=t(592),x=t(593),L=t(171),U=t(185),J=t(594),T=t(616),B=t(619),C=t(620),Z=t(309),W=t(597),V=t(610),G=t(607),q=t(621),H=t(617),$=t(615),F=t(622),K=t(598),Q=t(599),X=function(e){return n.a.createElement(w.a,Object.assign({},e,{rowsPerPageOptions:[10,25,50,100,500,1e3]}))},Y=function(e){return n.a.createElement(P.a,e,n.a.createElement(S.a,{source:"guests",alwaysOn:!0}),n.a.createElement(S.a,{label:"resources.users.fields.show_deactivated",source:"deactivated",alwaysOn:!0}))},ee=function(e){var a=Object(I.a)();return n.a.createElement(r.Fragment,null,n.a.createElement(A.a,Object.assign({},e,{label:"resources.users.action.erase",title:a("resources.users.helper.erase")})))},ae=function(e){return n.a.createElement(N.a,Object.assign({},e,{filters:n.a.createElement(Y,null),filterDefaultValues:{guests:!0,deactivated:!1},bulkActionButtons:n.a.createElement(ee,null),pagination:n.a.createElement(X,null)}),n.a.createElement(z.a,{rowClick:"edit"},n.a.createElement(D.a,{source:"Avatar",reference:"users",link:!1,sortable:!1},n.a.createElement(M.a,{source:"avatar_url",title:"displayname"})),n.a.createElement(R.a,{source:"id"}),n.a.createElement(D.a,{source:"name",reference:"users",link:!1,sortable:!1},n.a.createElement(R.a,{source:"displayname"})),n.a.createElement(x.a,{source:"is_guest",sortable:!1}),n.a.createElement(x.a,{source:"admin",sortable:!1}),n.a.createElement(x.a,{source:"deactivated",sortable:!1})))},te=Object(L.b)(/^[a-z0-9._=\-/][a-z0-9._=\-/][a-z0-9._=\-/][a-z0-9._=\-/][a-z0-9._=\-/]+/,"synapseadmin.users.invalid_user_id"),re=Object(L.b)(/^[a-zA-Z0-9.!#$%&\u2019*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+\.+([a-zA-Z0-9-][a-zA-Z0-9-]+)*$/,"Enter Proper Email Address"),ne=function(e){var a=Object(I.a)();return n.a.createElement(U.a,e,n.a.createElement(J.a,{submitOnEnter:!0}),n.a.createElement(T.a,{label:"resources.users.action.erase",title:a("resources.users.helper.erase")}))},se=function(e){return n.a.createElement(B.a,e,n.a.createElement(C.a,null,n.a.createElement(Z.a,{source:"id",autoComplete:"off",validate:te}),n.a.createElement(Z.a,{source:"displayname"}),n.a.createElement(W.a,{source:"password",autoComplete:"new-password"}),n.a.createElement(S.a,{source:"admin"}),n.a.createElement(Z.a,{source:"email",autoComplete:"off",validate:re}),n.a.createElement(Z.a,{source:"msisdn",autoComplete:"off"})))},oe=function(e){var a=e.record,t=Object(I.a)();return n.a.createElement("span",null,t("resources.users.name")," ",a?'"'.concat(a.displayname,'"'):"")},ie=function(e){return n.a.createElement(V.a,Object.assign({},e,{title:n.a.createElement(oe,null)}),n.a.createElement(G.a,{toolbar:n.a.createElement(ne,null)},n.a.createElement(q.a,{label:"resources.users.name",icon:n.a.createElement(j.a,null)},n.a.createElement(Z.a,{source:"id",disabled:!0}),n.a.createElement(Z.a,{source:"displayname"}),n.a.createElement(W.a,{source:"password",autoComplete:"new-password"}),n.a.createElement(S.a,{source:"admin"}),n.a.createElement(S.a,{source:"deactivated",helperText:"resources.users.helper.deactivate"}),n.a.createElement(H.a,{source:"threepids"},n.a.createElement($.a,null,n.a.createElement(F.a,{source:"medium",choices:[{id:"email",name:"resources.users.email"},{id:"msisdn",name:"resources.users.msisdn"}],key:"SelectInput"}),n.a.createElement(Z.a,{source:"address",key:"TextInput"})))),n.a.createElement(q.a,{label:"resources.connections.name",icon:n.a.createElement(k.a,null)},n.a.createElement(D.a,{reference:"connections",source:"id",addLabel:!1},n.a.createElement(K.a,{source:"devices[].sessions[0].connections",label:"resources.connections.name"},n.a.createElement(z.a,{style:{width:"100%"}},n.a.createElement(R.a,{source:"ip",sortable:!1}),n.a.createElement(Q.a,{source:"last_seen",showTime:!0,options:{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"},sortable:!1}),n.a.createElement(R.a,{source:"user_agent",sortable:!1,style:{width:"100%"}})))))))},ce=function(e){return n.a.createElement(w.a,Object.assign({},e,{rowsPerPageOptions:[10,25,50,100,500,1e3]}))},le=function(e){return n.a.createElement(N.a,Object.assign({},e,{pagination:n.a.createElement(ce,null)}),n.a.createElement(z.a,null,n.a.createElement(R.a,{source:"room_id"}),n.a.createElement(R.a,{source:"name"}),n.a.createElement(R.a,{source:"canonical_alias"}),n.a.createElement(R.a,{source:"joined_members"})))},ue=t(333),me=t(329),de=t(600),ge=t(220),pe=t(601),fe=t(184),be=t(21),he=t(526),ve=t(590),_e=t(623),Ee=t(602),ye=t(335),je=t(524),Oe=t(128),ke=t(177),we=t.n(ke),Pe=Object(Oe.a)((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"flex-start",background:"url(./images/floating-cogs.svg)",backgroundColor:"#f9f9f9",backgroundRepeat:"no-repeat",backgroundSize:"cover"},card:{minWidth:"30em",marginTop:"6em"},avatar:{margin:"1em",display:"flex",justifyContent:"center"},icon:{backgroundColor:e.palette.secondary.main},hint:{marginTop:"1em",display:"flex",justifyContent:"center",color:e.palette.grey[500]},form:{padding:"0 1em 1em 1em"},input:{marginTop:"1em"},actions:{padding:"0 1em 1em 1em"}}})),Se=function(e){var a=e.theme,t=Pe({theme:a}),s=Object(de.a)(),o=Object(ge.a)(),i=Object(r.useState)(!1),c=Object(me.a)(i,2),l=c[0],u=c[1],d=Object(I.a)(),g=function(e){var a=e.meta,t=(a=void 0===a?{}:a).touched,r=a.error,s=Object.assign({},e.input),o=Object(ue.a)(e,["meta","input"]);return n.a.createElement(he.a,Object.assign({error:!(!t||!r),helperText:t&&r},s,o,{fullWidth:!0}))},p=function(e){var a=e.formData,r=Object(be.e)();return n.a.createElement("div",null,n.a.createElement("div",{className:t.input},n.a.createElement(Z.a,{autoFocus:!0,name:"username",component:g,label:d("ra.auth.username"),disabled:l,onBlur:function(e){if(!a.base_url){var t=function(e){if(!e)return null;var a=e.match(/@[a-zA-Z0-9._=\-/]+:([a-zA-Z0-9\-.]+\.[a-zA-Z]+)/);return a?a[1]:null}(a.username),n="https://".concat(t,"/.well-known/matrix/client");t&&m.a.fetchJson(n,{method:"GET"}).then((function(e){var a=e.json;r.change("base_url",a["m.homeserver"].base_url)})).catch((function(e){r.change("base_url","https://".concat(t))}))}},fullWidth:!0})),n.a.createElement("div",{className:t.input},n.a.createElement(W.a,{name:"password",component:g,label:d("ra.auth.password"),type:"password",disabled:l,fullWidth:!0})),n.a.createElement("div",{className:t.input},n.a.createElement(Z.a,{name:"base_url",component:g,label:d("synapseadmin.auth.base_url"),disabled:l,fullWidth:!0})))};return n.a.createElement(be.b,{initialValues:{base_url:"https://m.navgurukul.org"},onSubmit:function(e){u(!0),s(e).catch((function(e){u(!1),o("string"===typeof e?e:"undefined"!==typeof e&&e.message?e.message:"ra.auth.sign_in_error","warning")}))},validate:function(e){var a={};return e.username||(a.username=d("ra.validation.required")),e.password||(a.password=d("ra.validation.required")),e.base_url?e.base_url.match(/^(http|https):\/\//)?e.base_url.match(/^(http|https):\/\/[a-zA-Z0-9\-.]+(:\d{1,5})?$/)||(a.base_url=d("synapseadmin.auth.url_error")):a.base_url=d("synapseadmin.auth.protocol_error"):a.base_url=d("ra.validation.required"),a},render:function(e){var a=e.handleSubmit;return n.a.createElement("form",{onSubmit:a,noValidate:!0},n.a.createElement("div",{className:t.main},n.a.createElement(ve.a,{className:t.card},n.a.createElement("div",{className:t.avatar},n.a.createElement(_e.a,{className:t.icon},n.a.createElement(we.a,null))),n.a.createElement("div",{className:t.hint},d("synapseadmin.auth.welcome")),n.a.createElement("div",{className:t.form},n.a.createElement(pe.a,null,(function(e){return n.a.createElement(p,e)}))),n.a.createElement(Ee.a,{className:t.actions},n.a.createElement(ye.a,{variant:"contained",type:"submit",color:"primary",disabled:l,className:t.button,fullWidth:!0},l&&n.a.createElement(je.a,{size:25,thickness:2}),d("ra.auth.sign_in")))),n.a.createElement(fe.a,null)))}})},Ie=t(327),Ae=t.n(Ie),Ne=t(182),ze=t(97),De=t.n(ze),Me=Object(p.a)(Object(p.a)({},De.a),{},{synapseadmin:{auth:{base_url:"Heimserver URL",welcome:"Willkommen bei Synapse-admin",username_error:"Bitte vollst\xe4ndigen Nutzernamen angeben: '@user:domain'",protocol_error:"Die URL muss mit 'http://' oder 'https://' beginnen",url_error:"Keine g\xfcltige Matrix Server URL"},users:{invalid_user_id:"Muss eine vollst\xe4ndige Matrix Benutzer-ID sein, z.B. @benutzer_id:homeserver"}},resources:{users:{backtolist:"Zur\xfcck zur Liste",name:"Benutzer",email:"E-Mail",msisdn:"Telefon",fields:{avatar:"Avatar",id:"Benutzer-ID",name:"Name",is_guest:"Gast",admin:"Admin",deactivated:"Deaktiviert",guests:"Zeige G\xe4ste",show_deactivated:"Zeige deaktivierte Benutzer",user_id:"Suche Benutzer",displayname:"Anzeigename",password:"Passwort",avatar_url:"Avatar URL",medium:"Medium",threepids:"3PIDs",address:"Adresse"},helper:{deactivate:"Deaktivierte Nutzer k\xf6nnen nicht wieder aktiviert werden.",erase:"DSGVO konformes L\xf6schen der Benutzerdaten"},action:{erase:"L\xf6sche Benutzerdaten"}},rooms:{name:"Raum |||| R\xe4ume",fields:{room_id:"Raum-ID",name:"Name",canonical_alias:"Alias",joined_members:"Mitglieder"}},connections:{name:"Verbindungen",fields:{last_seen:"Datum",ip:"IP-Adresse",user_agent:"User Agent"}}},ra:Object(p.a)(Object(p.a)({},De.a.ra),{},{auth:Object(p.a)(Object(p.a)({},De.a.ra.auth),{},{auth_check_error:"Anmeldung fehlgeschlagen"}),input:Object(p.a)(Object(p.a)({},De.a.ra.input),{},{password:Object(p.a)(Object(p.a)({},De.a.ra.input.password),{},{toggle_hidden:"Anzeigen",toggle_visible:"Verstecken"})}),notification:Object(p.a)(Object(p.a)({},De.a.ra.notifiaction),{},{logged_out:"Abgemeldet"})})}),Re=t(178),xe={de:Me,en:Object(p.a)(Object(p.a)({},Re.a),{},{synapseadmin:{auth:{homeserver:"Homeserver",welcome:"Welcome to Navgurukul Admin",base_url:"Homeserver URL",username_error:"Please enter fully qualified user ID: '@user:domain'",protocol_error:"URL has to start with 'http://' or 'https://'",url_error:"Not a valid Matrix server URL"},users:{invalid_user_id:"Please enter a proper username."}},resources:{users:{backtolist:"Back to list",name:"User |||| Users",email:"Email",msisdn:"Phone",fields:{avatar:"Avatar",id:"User-ID",name:"Name",is_guest:"Guest",admin:"Admin",deactivated:"Deactivated",guests:"Show guests",show_deactivated:"Show deactivated members",user_id:"Search Member",displayname:"Displayname",password:"Password",avatar_url:"Avatar URL",medium:"Medium",threepids:"3PIDs",address:"Address"},helper:{deactivate:"Deactivated members cannot be reactivated",erase:"Mark the member as GDPR-erased"},action:{erase:"Erase member data"}},rooms:{name:"Room |||| Rooms",fields:{room_id:"Room-ID",name:"Name",canonical_alias:"Alias",joined_members:"Members"}},connections:{name:"Connections",fields:{last_seen:"Date",ip:"IP address",user_agent:"User agent"}}}})},Le=Object(u.a)((function(e){return xe[e]?xe[e]:xe.en}),Object(i.a)()),Ue=function(){return n.a.createElement(c.a,{loginPage:Se,authProvider:d,dataProvider:E,i18nProvider:Le},n.a.createElement(l.a,{name:"users",list:ae,create:se,edit:ie,icon:Ae.a}),n.a.createElement(l.a,{name:"rooms",list:le,icon:Ne.ViewListIcon}),n.a.createElement(l.a,{name:"connections"}))};o.a.render(n.a.createElement(Ue,null),document.getElementById("root"))}},[[367,1,2]]]);
//# sourceMappingURL=main.6b3b79f3.chunk.js.map